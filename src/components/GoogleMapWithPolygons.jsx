import { useEffect, useRef } from "react";

const GoogleMapWithPolygons = ({ location, onZoneChange }) => {
  const mapRef = useRef(null);

  useEffect(() => {
    if (window.google && window.google.maps) {
      const map = new window.google.maps.Map(mapRef.current, {
        center: location,
        zoom: 13,
      });

      // Define los dos polígonos (ejemplo: coordenadas ficticias)
      const polygon1Coords = [
        { lat: -33.48926808012609, lng: -70.77430533092861 },
  { lat: -33.48967961856861, lng: -70.77320092282548 },
  { lat: -33.49074764969052, lng: -70.76969971415977 },
  { lat: -33.491913651112405, lng: -70.76575203687234 },
  { lat: -33.49243295724428, lng: -70.76404842862831 },
  { lat: -33.49260014575441, lng: -70.76239907098945 },
  { lat: -33.49201225292296, lng: -70.7579696895567 },
  { lat: -33.49185547992949, lng: -70.75587835784975 },
  { lat: -33.49151253997989, lng: -70.75502067921686 },
  { lat: -33.48927849773538, lng: -70.75269437240871 },
  { lat: -33.488651387851164, lng: -70.75209517226787 },
  { lat: -33.48777930561948, lng: -70.75196593302226 },
  { lat: -33.48651306701422, lng: -70.75160105426673 },
  { lat: -33.479157745797465, lng: -70.75580719994753 },
  { lat: -33.479098947568886, lng: -70.75728757676653 },
  { lat: -33.481303854380585, lng: -70.76105901346884 },
  { lat: -33.48230337584291, lng: -70.7627860830635 },
  { lat: -33.48334210024894, lng: -70.76374950289758 },
  { lat: -33.485399913705166, lng: -70.76739169983239 },
  { lat: -33.486752161530546, lng: -70.76972974512861 },
  { lat: -33.48939780947811, lng: -70.77453508710964 },
  { lat: -33.489321609292894, lng: -70.7742052845554 }
      ];
      const polygon2Coords = [
  { lat: -33.47871119680305, lng: -70.75590513581552 },
  { lat: -33.478792378808855, lng: -70.75092590116036 },
  { lat: -33.478804494191216, lng: -70.74712867848913 },
  { lat: -33.478804495045786, lng: -70.74628392977311 },
  { lat: -33.47890333094792, lng: -70.74520201375296 },
  { lat: -33.47892662592895, lng: -70.74316159309599 },
  { lat: -33.481019213198415, lng: -70.74491829450342 },
  { lat: -33.47777533302049, lng: -70.74227219003754 },
  { lat: -33.47790858640927, lng: -70.74143232694462 },
  { lat: -33.47996659173239, lng: -70.74014910517455 },
  { lat: -33.48245112451868, lng: -70.73830190547899 },
  { lat: -33.48308959537777, lng: -70.74054017363248 },
  { lat: -33.483707242944526, lng: -70.74284501289243 },
  { lat: -33.4840334146012, lng: -70.74378525417869 },
  { lat: -33.48433876461115, lng: -70.7448586274086 },
  { lat: -33.48419996880073, lng: -70.74505832467274 },
  { lat: -33.484359583963496, lng: -70.7451332111468 },
  { lat: -33.48438040331083, lng: -70.74569069934327 },
  { lat: -33.48432488503984, lng: -70.74628979113685 },
  { lat: -33.48562315177722, lng: -70.74745533098728 },
  { lat: -33.48698331912693, lng: -70.7499099437776 },
  { lat: -33.487316417992844, lng: -70.75096667513499 },
  { lat: -33.48594237691164, lng: -70.75171553987664 },
  { lat: -33.482506210561255, lng: -70.75365899790438 },
  { lat: -33.47645164512005, lng: -70.75720632572401 },
  { lat: -33.47387374495621, lng: -70.75888812742191 },
  { lat: -33.475601944801625, lng: -70.75998646340531 },
  { lat: -33.477753470245666, lng: -70.76111807934177 },
  { lat: -33.477725708991485, lng: -70.76210824494406 },
  { lat: -33.47842667794637, lng: -70.76229130076972 },
  { lat: -33.47878757064116, lng: -70.76203335846999 },
  { lat: -33.47902353812962, lng: -70.76271565745657 },
  { lat: -33.48057813228376, lng: -70.7655613489613 },
  { lat: -33.48184336332774, lng: -70.76800188661392 },
  { lat: -33.483168890297925, lng: -70.77048146098058 },
  { lat: -33.484668136716365, lng: -70.77340359082334 },
  { lat: -33.48604913766071, lng: -70.77620767324424 },
  { lat: -33.48752032791684, lng: -70.77929465409146 },
  { lat: -33.48747869072668, lng: -70.78034306472932 },
  { lat: -33.48791588022482, lng: -70.7800351981136 },
  { lat: -33.48994912986592, lng: -70.7842122000631 },
  { lat: -33.49064999990653, lng: -70.78565168451085 },
  { lat: -33.49260685454261, lng: -70.78502763055928 },
  { lat: -33.49282224327539, lng: -70.78539914412515 },
  { lat: -33.49326634486749, lng: -70.78509959822898 },
  { lat: -33.493509211962156, lng: -70.78478341089371 },
  { lat: -33.493856163773586, lng: -70.78447554427585 },
  { lat: -33.49624340206785, lng: -70.78385521796149 },
  { lat: -33.49693728238581, lng: -70.78377201076792 },
  { lat: -33.49642381148567, lng: -70.78116762561174 },
  { lat: -33.49537976098923, lng: -70.7768769573211 },
  { lat: -33.49437790712127, lng: -70.77359913076342 },
  { lat: -33.4932743927495, lng: -70.76863713097576 },
  { lat: -33.49250415267194, lng: -70.76560006841261 },
  { lat: -33.49238618737018, lng: -70.76525891891932 },
  { lat: -33.491962898788444, lng: -70.76569991704525 },
  { lat: -33.491393884648, lng: -70.76798811486617 },
  { lat: -33.49093589494154, lng: -70.76951080650753 },
  { lat: -33.48996439549435, lng: -70.77256635378895 },
  { lat: -33.489450883955094, lng: -70.77440523661589 },
  { lat: -33.48918024789443, lng: -70.77457165100306 },
  { lat: -33.48852100266757, lng: -70.77334018453895 },
  { lat: -33.488590397138836, lng: -70.77311552511681 },
  { lat: -33.48846548705073, lng: -70.77275773418445 },
  { lat: -33.48825036370092, lng: -70.77282429993956 },
  { lat: -33.48656316915286, lng: -70.76970565323428 },
  { lat: -33.48583450738139, lng: -70.76840762101567 },
  { lat: -33.485792885580764, lng: -70.76792385355122 },
  { lat: -33.485480599938164, lng: -70.76745789326728 },
  { lat: -33.4842800246479, lng: -70.76549420350057 },
  { lat: -33.48323796259008, lng: -70.76372599226696 },
  { lat: -33.482245555044635, lng: -70.76277743026115 },
  { lat: -33.48076550321774, lng: -70.76042251306724 },
  { lat: -33.479502401044975, lng: -70.75826744675537 },
  { lat: -33.47900964890286, lng: -70.75715246469223 },
  { lat: -33.47890554566197, lng: -70.75653673146078 },
  { lat: -33.47896800762152, lng: -70.75596260182523 },
  { lat: -33.47868345832959, lng: -70.75588771535116 }
];
      const polygon1 = new window.google.maps.Polygon({
        paths: polygon1Coords,
        strokeColor: "#FF0000",
        strokeOpacity: 0.8,
        strokeWeight: 2,
        fillColor: "#FF0000",
        fillOpacity: 0.2,
      });
      polygon1.setMap(map);

      const polygon2 = new window.google.maps.Polygon({
        paths: polygon2Coords,
        strokeColor: "#0000FF",
        strokeOpacity: 0.8,
        strokeWeight: 2,
        fillColor: "#0000FF",
        fillOpacity: 0.2,
      });
      polygon2.setMap(map);

      // Marca la ubicación del usuario
      new window.google.maps.Marker({
        position: location,
        map,
        title: "Tu ubicación",
      });

      // Detecta en qué polígono está la ubicación
      let zone = null;
      if (window.google.maps.geometry.poly.containsLocation(
        new window.google.maps.LatLng(location.lat, location.lng),
        polygon1
      )) {
        zone = "zona1";
      } else if (window.google.maps.geometry.poly.containsLocation(
        new window.google.maps.LatLng(location.lat, location.lng),
        polygon2
      )) {
        zone = "zona2";
      }
      if (onZoneChange) onZoneChange(zone);
    }
  }, [location, onZoneChange]);

  return (
    <div
      ref={mapRef}
      style={{ width: "100%", height: "350px", borderRadius: "8px", marginBottom: "1rem" }}
    />
  );
};

export default GoogleMapWithPolygons;